x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: OllyWindowPos  ---

著者：金床

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) はじめに

　WizardBibleもついに40号を迎えたということで、編集部の方々にはお祝い申し
上げる。最近は外国人の読者も着実に増えているらしく、外国人が日本語を学ぶ
動機のトップ3は

1位　ビジネスで使う
2位　アニメ・漫画を読みたい
3位　ウィザードバイブルを読みたい

　となっているというウワサである。

　さてめでたい40号だが、いかんせん育児と仕事の両立で苦しんでいるのでネタ不
足である。というか2月と3月働き過ぎてカローシである。ハラキリ・サムライ・フジヤマ・ゲイシャ
・スシ・カローシ。
　えーと、なんの話だっけ。


■0x02.) つぎに

　そうそう、ネタ不足という話であった。
　WizardBibleで日本語を勉強している外国人のためにラテン系紳士の金床が親切丁
寧に説明するが、「ネタ」とはスシの上部に位置する魚介類を指す。そしてごはん（
ライス）の部分はシャリとよぶ。「ネタ」と「シャリ」が渾然一体となってかもしだす優
雅な味こそがスシの真骨頂である。そして「ネタ不足」というのは「お客さんがいっ
ぱい来たので今日はもう何も出せません」という店側からのメッセージだ。

　「ネタ」は「サシーミ」に似ているが、異なる。これは素人が間違えやすい点なので
注意したい。「サシーミ」は最初からそれ単体で食べられることを目的に加工された
食品であり、料理法も異なるのである。「スシ」が出てきたときに「サシーミから先に
タベマス」などといってネタだけ食べてはいけないので注意したい。
　えーと、なんの話だっけ。


■0x03.) つづいて

　ということでネタ不足なので、こんなときのためにハードディスクの奥にしまっておい
たOllyDbg用のプラグインの「OllyWindowPos」を取り出すことにした。かつて筆者が
mixiを使っていたころに適当にmixi内で公開したものだ。また最近では筆者のウェブ
サイトに置いてあるので、知っている人もいるかと思う。

　このプラグインはユーザインターフェースを改善する目的で作ったもので、OllyDbgでたくさ
ん登場するウィンドウの大きさや位置を記録・再生するものだ。メインウィンドウの位置もコ
ントロールでき、特にデュアルディスプレイユーザにオススメである。なぜならばOllyDbgは起
動したときに片方のディスプレイにおさまるようサイズを自ら調整してしまうからだ。
デュアルディスプレイ全体に広がるように各ウィンドウを配置しても、再起動すると元に戻っ
てしまうのである。これは筆者にとって非常にストレスであり、OllyWindowPosという
プラグインを作ることになったのだ。

　ダウンロードは以下から。
　http://www.jumperz.net/tools/OllyWindowPos.tar.gz


■0x04.） プラグインの作成方法

　OllyDbgのプラグインはDLLとして作成し、exeと同じディレクトリに置くだけで使えるよ
うになる。詳しくはクラッキングバイブルのDokoDonさんの記事を読んでいただきたい。
筆者はこのDokoDonさんの記事のおかげですんなりプラグインの作成に入ることがで
きた。


■0x05.） BCB

　OllyWindowPosはBorland C++ Builder5で作成されている。プロジェクトファイルなども
すべてまとめて置いてあるので、今時BCBを使っているマニアがいればそのままビルド
することができる。


■0x06.） 使い方

　OllyWindowPosをインストール（DLLをディレクトリにコピー）してからOllyDbgを起動すると、
「plugins」メニューに「Window Position」メニューが追加される。いくつかのウィンドウを
好きな位置・好きな大きさにしてから「Save as 1」を選ぶとそのときのポジショ
ンが「1」として記録される。ウィンドウの位置をばらばらに変えた後から「Restore
 1」を選ぶと先ほど保存したときの状態に戻すことができる。データは1から5まで
用意されているので、好きなポジションを5つまで保存しておくことができる。


■0x07.） Sauceコード

　筆者はJava使いなのだがこのプラグインはC++で作成されている。WindowsのAPIを
直に呼び出すということもあまりやったことがなかったので実に勉強になった。
見てもらえばわかるように「動けばいいや」的なやっつけ仕事になってしまって
いるが、これは小さなプログラムということでご勘弁いただきたい。Java使いら
しく横着にvectorやstring、mapなどを使いまくってみた。

　各ウィンドウを表示する処理ではメニューが選択されたように（OllyDbgプロセスに）見せ
るためにPostMessageを使ってみた。この再引数に当たる数字（2109や2117など）
はリソースハカーというツールでハカーした記憶がある。
　また各ポジションはiniファイルに保存されており、この情報を取り扱う際にはOllyDbg
がプラグイン向けに提供しているAPIを利用している。


■0x08.） おわりに

　今回はネタとサシーミの違いについて詳しく解説した。次回は「日本人の宗教とカローシ」
についてお話したいと思う。



