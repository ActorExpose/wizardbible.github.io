x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: Black Hat Europe 2009 レポート ---

著者：金床

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x00.) はじめに

　4月の中旬にアムステルダムでBlack Hat Europe（BHE）が開催された。誰でも
人生のうち一度は巡礼せねばならぬとされる聖地アムス。筆者はサーバー管理の仕事
を同僚に押しつけると、一週間ほどの聖地巡礼ツアーを敢行したのである。


■0x01.) シークルマップ

　（…悪いが、話はいきなりBHEの真っ最中に飛ぶ。まぁ、アムスでBHE以外に何やっ
てたかは書くまでもない。そう、チューリップの閲覧、風車を主題とした力学の
基礎の習得、そして木靴制作だ。よく「アムス=葉っぱ」とか「アムス=飾り窓」とか思
ってるヤシがいるけど、そういう人は「葉っぱ」「日記」でググるとそれっぽいサイ
トが出てくるからそっちを見てくれよな。）

　さてシークルマップはsqlmapのことだ。SQLインジェクションの検査に使える有名な
（？）ツールである。今回のBHEではこのsqlmapの作者であるベルナルドなんとか（
読めない）がスピーカーとして登場した。数少ないWAS(web app sec)関連のセッションだっ
たので筆者は当然参加したのである。セッションのタイトルは「Advanced SQL injection 
to operating system full control」だ。まさか、またSQLインジェクションする
ための新しい手法が発見されたのか？とwktkしながら最前列で話をきいた。

　しかし結論から書くと、「SQLインジェクションがある場合にはこんなに傷口を
広げられますよ」という方向でのセッションであった。SQLインジェクションそのものを
実現するための新しい手法ではなく、あくまで脆弱性がある場合のネタだ。今まで
知られていない方法でRDBMS経由でシステムの制御を奪うような話であり、技術的
な詳細まで適切に説明してくれたので、筆者としてはなかなか楽しめた。

　彼はRDBMS経由でシステムコマンドを実行するためにユーザ定義関数（UDF）を
使用する手法を編み出した。MySQLやPostgreSQL上で実行されるSQLから、共有ラ
イブラリ（.dllファイルなど）を目標のシステム上にアップロードし（ファイルを書
き込み）、その中に定義された関数をUDFから呼び出すのである。これはかなり
目からウロコの攻撃手法であった。デモも華麗に決まり、SQL経由でシステムコ
マンドが実行された。

　筆者も拙著「ウェブアプリケーションセキュリティ」でPostgreSQL上のPL/Per
lUを利用してシステムコマンドを実行する例を発表したが、その手法に比べると、
あらかじめパッケージ化されているPostgreSQLへの攻撃などで有利とのことであ
る（パッケージ化されたPostgreSQLではPL/PerlUが有効になっていないケースが殆ど
とのこと）。それに、この手法はMySQLでも使うことができる。

　ベルナルドはいかにも英国という感じの英語で話していた。「data」が「ダータ」
だったりしてかなり強烈だった。

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Damele


■0x02.) フォカ

　続いて紹介するのはメタデータに関するセッションである。エクセルやワードなどのオフィスドキュメ
ントはもちろん、pdf、jpegのような画像ファイルまで、ファイルを作成した人自身が意識し
ていないデータを含むファイル形式は数多い。Googleなどでは多数のオフィスドキュメントやpdf
が入手できるため、それらからメタデータを抽出し、面白そうなものがないかを探す
ことが可能である。スペインから来た陽気な二人組のセッションは、このメタデータを主題と
したものだ。

　企業などが各種のファイルをインターネット上で公開する際には、これらのメタデータ
の中身についても把握し管理する必要があるだろう。筆者はMSオフィスは基本的には
あまり使わないのだが、どうしても仕事の内容上使わざるを得ない場合も存在す
る。このようなときはあまり深く考えずにファイルを作ってメールで送ったりしてしまう
が、もしかしたらメタデータの中にとんでもない情報が入ったりしていなかっただろ
うかと不安になった。これらのメタデータを可視化し、必要に応じて選択して削除で
きるようなツールが今後メジャーになってくるだろうと感じた。

　彼らはFOCAと名付けられたツールとオンラインサービスを公開したので、少し触ってみると
面白いかもしれない。これはファイルに含まれるメタデータを抽出するものだ。筆者が試
そうとしたときにはツールはうまくダウンロードできなかったが、オンライン版は機能してい
た。ただし日本語については化けてしまっているようだった。

　彼らはいかにもスペインといった感じの巻き舌の英語でボケ・ツッコミを繰り返し、絶
えず聴衆を笑わせていた。さまざまな人種の多彩な英語でセッションが行われるのが、
いかにもBHEという感じだった。

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Alonso


■0x03.) WAFネタ

　アムスまで来てヨカッタと思わせてくれたのがイタリアーノWAF（なんだそれ）である。ミラノ
（大学？）から来た2人組は、ホワイトリスト方式・ブラックリスト方式のWAFともに完璧ではな
いと前置きした上で、高度なアノマリ検知を行うWAFについて研究を行っており、その
内容について発表を行った。どうせなら実用にかなり近いレベルまで持ってきてか
ら発表してくれればと思わないでもなかったが、その中身は非常に興味深いもの
だった。

　彼らがウリにしている点の1つが「通常の（正常な）通信と、攻撃の通信の両方
が入り乱れた場所においても学習していくことができる」というエンジンである
（たしか、正常な通信の方が多ければOKと言っていた気がする）。リクエスト中
の各情報を分析し、それが他の大多数のリクエストと似たパターンを持つか、あ
るいは「距離が離れた」パターンを持つか、などを調べることでアノマリ検知を行う
らしい。具体的な技術的詳細は筆者には難しくて理解不能なので、興味がある人
はぜひ資料を見ていただきたい。

　また、レスポンス中のHTMLのタグ構造を解析し、それらの傾向に着目するエンジンも考
えているらしい（筆者はイケピョンさんのスキャナーを思い出した）。

　いかにも研究者らしい発想のこのWAFがどの程度の実用製を持つのか、これから
動向を追っていくつもりである。筆者もWAFの開発者なので、このセッションを聴いて
いる最中にはさまざまなアイデアが浮かんできて楽しむことができた。インスパイアッ-(゜д゜) ッド!!

　しかしイタリア人なのに英語ペラペラでした。マシンガントーク。ヨーロッパの人はみんな英語
うまいなぁ…

　資料などはこちら
　http://www.blackhat.com/html/bh-europe-09/bh-eu-09-archives.html#Zanero


■0x04.) 他のセッション

　他にもいくつかのセッションを見たのだが、ジャンル的に興味がないものが多かったの
で既に覚えていない（筆者の記憶が消し飛ぶ速度はかなり速く、ほとんど病気な
レベル）。Linuxのexploitネタのセッションではカナリー値を使うスタックプロテクションを
「Cookie」って呼んでいて、フーン同じ意味なんだ？とか思ったくらいだろうか…。
あ、あとSSLのやつは思ったより面白くなかったなぁ…。


■0x05.) いろいろ

　そういえば、今年は残念なことにBlack Hat Japanはないらしい。まぁ、ここ数
年、参加者が増えていく気配が感じられなかったのでナットクしてしまう。Black Hat
の雰囲気や内容が好きなので、BHEに行っておいてよかった。そのBHEも来年はアムス
ではなくバルセロナになるとか。

　アムスではBHJで知り合いになったスタッフ（トラビスとかドミニクとかジェフとか）がよくし
てくれた。トラビスなんか筆者が受付していたら割り込んできてhackerタグ付けてく
れたりして、底なしにイイ人である。ジェフとはスペースとコズミックの違いについて議論し
た（謎。

　日本人の参加者は筆者だけだったらしい。他に中国人が数人、韓国人が数人い
たようだ。韓国の人とは休憩時間に少し話をすることができた。どうやら会社の
経費で来ているらしく、去年のBHJにも来たと言っていた。POCとかのことはあま
りしらないようだった。

　アムスでまいったのはコーヒーがまずいことである。結局滞在している一週間、まとも
なコーヒーには一杯もありつけなかった。なんか酸っぱいというかとにかくダメなので
ある。というかあれはコーヒーではなく別の飲み物（コーヒー茶みたいなもの）だったに
違いない。最悪スタバがあればショット追加のアメリカーノで逃げることができたのだが、アム
スにはどうもスタバはないらしい。ドミニクに「スタバないの？」ってきいたら「スキポール
まで逝けばあるよ。電車で15分くらいだよ」って言われたし…めんどくさいから
行くわけないし。スキポールのスタバはもちろん成田から到着時に速攻でチェックしてあっ
たのでそれは知っていたし。

　そして予想どおりアムスのメシはまずかった。正確には別にマズくはないのだがおい
しくなかった。BHEの昼飯もイマイチ、オタルとかいうスシも食える店もまずかったし、中
華料理屋もぱっとしなかった。パン屋さんで買ってきたパンも日本に比べるとマズイ。
滞在中いちばん旨かったのはホテルの朝食（バイキング形式）で食べることがで
きるグレープフルーツ。オランダはグレープフルーツがウマいのか、意外だ…と思っていたら貼
ってあったシールにフロリダって書いてあった件について。

　BHEはBHJに似た規模で、予想していたより人が少ない。雰囲気はアットホーム
で、スピーカーも簡単に捕まえて話をきくことができる感じ。ただ日本とは異な
りスーツ着てる人は皆無。というかアムスにスーツの人が皆無ｗ　トキオー帰ってき
たらマジスーツ多いよ…。前にMSの人が「黒いスーツが多くてビビった」って言っ
てのナットクした…。



