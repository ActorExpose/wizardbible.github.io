x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x

--- 第○章: デジタルフォレンジック ---

著者：黒林檎

x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x
x0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0xx0xXx0x


■0x01.) 挨拶

　今回はデジタルフォレンジックついて書いてみたいと思います。
　このサイトを閲覧している皆様は業務でデジタルフォレンジック（以下DF）を行っている方が多数いらっしゃっておると思いますので大変恐縮ですので読み飛ばしていただいて結構です。

　今回は裁判に提出し証拠となるような高度なDFではありません。
　実際の業務で行うDFは証拠となりうる根拠から行います。Best evidence rule、即ち最良証拠の原則にのっとって解析しなければなりません。
　それについてはここらへん読んでもらえたら結構です。
http://www2.tamacc.chuo-u.ac.jp/kikoh/sec_ikusei/sec2006/open2006text/08225-1.pdf

　次にデータのコピーです。
　DFにおいてオリジナルを解析することはまずありません。
　しかし最良証拠の原則により、オリジナルでなくても、オリジナルのコピーでも原則的に同等の証拠として扱えます。

　そしてこのオリジナルコピーの方法ですが…。
　ビットストリームコピーと論理コピーという手法があります。
　ビットストリームコピーというのはオリジナルとまったく同じものを作成するといったものです。

　この方法ではオリジナルを正確に1ビットずつすべて未使用領域すらも正確にコピーします。対して、論理コピーはファイル実データのみをコピーする方法です。

　証拠として使えるDFの定義はもっと複雑です。
　後は必要時応じて追々説明していきます。

　後言い忘れましたが、今回のDFの対象はHDDとします。
　それではだらだらと法律（？）について語っているのも面白くないので、DFをやっていきましょう。

■0x02.) ファイルの保存と削除

　最初にNTFSでのHDDへのファイルの保存と削除を勉強しましょう。

　デジタルフォレンジックという言葉を聞いて最初に連想するのはデータの復元ではないでしょうか。
　ドラマや映画のハッカーでは、Enter一回でデータを復元してカッコよくきめてしまうが、あれは嘘です。DFは「砂漠の中に落ちたダイヤを探すようなもの」と例えることができます。

　今回はそのような難しいことはしないで、「風呂に落ちた指輪を探す」程度のようなことを行っていきます。

　それでは管理情報からの復元方法を見ていきます。
　NTFS（http://e-words.jp/w/NTFS.html）の場合ファイルシステムの管理情報が2種類存在します。
　1つ目は$Bitmap、2つ目はMFTです。
　前者の方は$Bitmapはクラスターの利用状況を管理するテーブルであり、後者は$MFTはパーティション内のすべてのファイルやフォルダ情報を管理するテーブルです。

　ファイルシステムについては次のWebページを参考にしてください。

http://support.microsoft.com/kb/100108/ja

　必要項目は後で解説していきますので、HDDへのファイル保存と削除について解説します。

■0x03.) ファイル保存

1.最初に。A.doc用のレコードとして確立します。
2.次に基本情報やファイル名などの書き込みます。
3.それが終われば、$Bitmapから利用可能なクラスターを確保します。
4.そして、クラスターが連続していない場合はオフセットの値を記録します。
5.最後に、データ領域の該当クラスタへデータを格納します。

■0x04.) ファイル削除

1.最初にレコードを解放します。このときファイル保存1のときに確立したエントリビットマップに立てた1を0にします。
2.$Bitmapのビットデータを0にして、クラスターとのつながりを消します。
3.データ領域でのデータは消えずに、実際に消したはずのデータは$Bitmapとして残っているわけです。ただし、ファイル保存時に書き込んだものは消えます。

　データを完全に消去するにはデータを書き込みます。要するに物理メモリを完全に埋めることで完全削除できます。

　それでは消したはずのデータが実際は消えていないことを説明をしましたので、次にいきたいと思います。

■0x05.) Autopsy

　やっぱりこういう企画にはAutopsyが定番ですよね。
　Windowsなら、FTK ImagerがありますがAutopsyの人気のが高いのかな？
　変態の国日本だからなのか、技術者的にはGO言語とかLinuxとか愛用してる方が多い国だからなのか、LinuxのDFツールを使用してる方が周りに多いのでしょうか？

　まぁそれはさておき、実際Autopsyがこのような企画に王道化されてきたのは、私的にはデジタルフォレンジックツールが高価であるのが理由の1つであると思います。
　実際DFの値段がそれを示しています、高度な教育を受けた専門家が行うDFはかなり高額なのに対して、民間？が行うDFは10万程度と財布にやさしい傾向にあります。
　まぁそこらへん証拠保全とかいろいろ積もり積もった結果金額に反映していると思われますが。

　それではAutopsyを起動させてください。
　BackTrackを使用している方はデフォルトで収録されております。

# /usr/bin/autopsy 

　起動させたらブラウザからアクセスします。

　そうそうLinuxのddコマンドを利用しましょう。

　とりまイメージ化させます。

# dd if=/dev/sdb of=/var/disk-img/some-windows-hdd.img

　ddコマンドの使い方はネット検索すれば多数出てきます。

　それでは解説に戻ります、いきなりですがAutopsyで最初に3つの選択肢がありますが、"NEW CASE"を選択してください。
　入力画面になりましたので案件やホストを登録します。
　入力項目の3つすべて同一でかまいません（処理結果に変わりはないという意味です）。
　次はホストの登録ですがこれも今回は処理結果に変わりはないので飛ばします。

　それではやっと本命のディスクイメージを選択する画面になりました。
　イメージを選んでください。
　それではさっそくディスクイメージを選択してから、"ANALYZE"を選択します。
　"File Analize"を選ぶと、"File serch"を行う画面になります。
　目的のファイルまたは拡張子を検索すればファイル名に検索した名前がついているファイル一覧が抽出されます。

　Autopsyはもちろんファイルをキーワード検索することもができます。"KEYWORD SERARCH"を選択してください。
　なにかしら拡張子を検索してください。検索結果を１つ選択すれば詳細にデータユニットをみることができ、MFTのリンクを選択すれば閲覧できエクスポートすることにより対象をファイルに保存することも可能です。

　次に、別のモードである"METADATA MODE"を解説します。
　メタデータを解析することはとても重要です。メタデータにはファイル作成者や日時といったデータ管理において重要な情報が詰まっているからです。解析に手詰まったらメタデータを調べるとよいでしょう。
　モード選択したら"ALLOCATION LIST"を開いてください。MFTの状態を確認できます。
　復習ですがMFTは「パーティション内のすべてのファイルやフォルダ情報を管理するテーブル」であす。
　削除されたファイルは赤字表示だ、ファイル名の後ろには.jpg/(deleted)と表示されて、とてもわかりやすいです。
　もちろん先ほど同様エクスポートして、保存することができます。

　さてさて削除したファイルを表示させることはできました。これは大きい一歩です。
　さらにAutopsyでは削除されたデータを復元することが可能です。
　しかしこれには一定のルールがありました。最初に述べたように、一般的に削除したデータはデータ領域にまだ残っていて$Bitmapとのつながりを切っただけにすぎず、完全削除は物理メモリを完全に埋めることで削除することができるのです。

# dd if=/dev/zero of=/dev/hda

　上記のように、ddコマンドで簡単に実行できます。

　....と話がそれてしまいました。

　さてルールというほどでもありませんが、データ領域から削除されているデータは復元が難しいです。
　削除されていなければ簡単です。先ほど最初にやったFILE ANALYSISモードを開いて、削除されているファイル（赤色表示されているファイル）をエクスポートすることで達成できるからです。

　どうだったでしょうか。ドラマでは適当にコマンドタイプして「復元完了（キリっ）」とか言っていますが、実際はGUIの画面をマウスでポチポチ操作するだけで実現できるのです。

　まぁAutopsy自体がSleuth KitってCUIベースのデジタルフォレンジックツールをGUI化さした奴なんだけどね。

　後はディレクトリを復元するぐらいでしょうか。"FILE ANALYSIS"でエクスポートすることができます...。圧勝です。

　削除ディレクトリを選択しさらに削除されたデータファイルを探していきます。
　削除されたファイルを選択することで、元のディレクトリ情報を手に入れ同じファイルのMFTを参照することができます。

■0x06.) 感想

　今回はデジタルフォレンジックについてまとめました。
　そうそう皆さんはうインターネットフォレンジックという言葉は聞いたことがあるでしょうか？
　クラッカーといえばCrackerを連想しKrackerという言葉が世間的に知られていないように、フォレンジックといえばデジタルフォレンジックを連想しインターネットフォレンジックが知られていないのかもしれませんね。
　フォレンジックというのは犯罪捜査に科学的手法を取り入れたものをさすと聞いたことがあります。
　デジタルフォレンジックはコンピューターがどのように犯行にかかわっているか捜査します。逆にインターネットフォレンジックというのは個別のマシンからインターネットへと、その中心が変化します。
　インターネットの中で違法行為またはその陰に隠れたものを探す行為がインターネットフォレンジックといいます。簡単にいうならばインターネットに残された証拠を探す作業です。

　最近ではそちらにも興味を持っています。
　より多くの実践的なハッキング技術を使いこなしてやるのが二十歳までの目標です。

